---
import { ViewTransitions } from 'astro:transitions';
import Footer from '@/components/Footer.astro';
import Header from '@/components/Header.astro';
import Nav from '@/components/Nav.astro';
import Seo from '@/components/Seo.astro';
import type { Menu } from '@/utils/types'
import type { PostTypeSeo, TaxonomySeo } from '@/gql/sdk';

import '@/styles/global.css';

export type Props = {
  showHeader?: boolean,
  primaryMenu?: Menu | null,
  footerMenu?: Menu | null,
  title: string,
  description:
  string,
  seo: PostTypeSeo | TaxonomySeo
};

const {
  showHeader = true,
  title,
  description,
  primaryMenu,
  footerMenu,
  seo,
  ...head
} = Astro.props;

const PUBLIC_GTM_ID = import.meta.env.PUBLIC_GTM_ID;
---

<!doctype html>
<html lang="es" class="antialiased break-words">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <meta name="generator" content={Astro.generator} />

        <!-- Preconnect to Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

        <!-- Preload fonts -->
        <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400..700&family=Newsreader:ital,opsz,wght@0,6..72,400..700;1,6..72,400..700&display=swap" />

        <!-- Load fonts asynchronously -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400..700&family=Newsreader:ital,opsz,wght@0,6..72,400..700;1,6..72,400..700&display=swap" media="print" onload="this.media='all'" />

        <!-- Fallback in case JavaScript is disabled -->
        <noscript>
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400..700&family=Newsreader:ital,opsz,wght@0,6..72,400..700;1,6..72,400..700&display=swap" />
        </noscript>

        <Seo seo={seo} baseUrl="https://ronnyfreites.com" />

        <!-- Theme script -->
        <script>
            (function() {
                if (localStorage.theme === 'dark') {
                    document.documentElement.classList.add('dark');
                }
            })();
        </script>

        <script type="text/partytown" src={`https://www.googletagmanager.com/gtag/js?id=${PUBLIC_GTM_ID}`}></script>
        <script type="text/partytown">
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', PUBLIC_GTM_ID);
        </script>

        <script>
          partytown = {
            forward: ['dataLayer.push']
          };
        </script>

        <ViewTransitions />
    </head>
    <body class="bg-main text-main">
        <div class="flex flex-col min-h-screen px-4 md:px-8">
            <Nav menu={primaryMenu} />
            {showHeader && <Header title={title} description={description} />}
            <main class="grow w-full max-w-3xl mx-auto">
                <slot />
            </main>
            <Footer menu={footerMenu} />
        </div>
    </body>
</html>
